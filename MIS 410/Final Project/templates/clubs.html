<!-- @ts-nocheck -->
{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h2 fw-bold mb-0">Clubs at CSUSM</h1>
    <p class="text-muted mb-0">Discover organizations, find your people, and get involved.</p>
  </div>

  {% if current_user.is_authenticated and current_user.role == "officer" %}
    <a href="{{ url_for('club_create') }}" class="btn btn-primary">
      + Create Club
    </a>
  {% endif %}
</div>

{# Search bar (respects which tab you're on) #}
<form class="row g-2 mb-4" method="GET" action="{{ url_for('clubs') }}">
  <div class="col-md-6 position-relative">
    <input
      type="text"
      name="q"
      id="clubSearch"
      class="form-control form-control-sm"
      placeholder="Search clubs by name or description..."
      value="{{ search_query or '' }}"
      autocomplete="off"
      style="border: 1px solid #dee2e6; transition: all 0.3s ease; padding: 0.5rem 0.75rem; font-size: 0.95rem;"
    >
    <div id="searchSuggestions" class="position-absolute w-100 mt-1" style="display: none; z-index: 1000; background: white; border: 1px solid #dee2e6; border-radius: 0.375rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
      <div class="list-group list-group-flush" id="suggestionsList"></div>
    </div>
  </div>
  <div class="col-md-3">
    {% if my_only %}
      <input type="hidden" name="my" value="1">
    {% endif %}
    <button type="submit" class="btn btn-primary btn-sm w-100" style="font-weight: 500; font-size: 0.9rem; transition: all 0.3s ease; padding: 0.5rem 0.75rem;">
      Search
    </button>
  </div>
</form>

{# TABS: My Clubs / All Clubs #}
<ul class="nav nav-tabs mb-3">
  {% if current_user.is_authenticated %}
    <li class="nav-item">
      <a
        class="nav-link {% if my_only %}active{% endif %}"
        href="{{ url_for('clubs', my=1, q=search_query) }}"
      >
        My Clubs
      </a>
    </li>
  {% endif %}
  <li class="nav-item">
    <a
      class="nav-link {% if not my_only %}active{% endif %}"
      href="{{ url_for('clubs', q=search_query) }}"
    >
      All Clubs
    </a>
  </li>
</ul>

<div class="tab-content">
  {# --- MY CLUBS TAB CONTENT --- #}
  {% if my_only and current_user.is_authenticated %}
    <div class="tab-pane fade show active">
      <h2 class="h5 fw-bold mb-3">My Clubs</h2>

      {% if my_clubs %}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
          {% for club in my_clubs %}
            <div class="col" style="animation: fadeInUp 0.5s ease-out backwards; animation-delay: {{ loop.index0 * 0.1 }}s;">
              <div class="card h-100 shadow-sm">
                {% if club.logo_filename %}
                  <img
                    src="{{ url_for('static', filename='uploads/' ~ club.logo_filename) }}"
                    class="card-img-top club-logo-img"
                    alt="{{ club.name }} logo"
                    width="100%"
                    height="70"
                  >
                {% endif %}
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title mb-1">
                    <a href="{{ url_for('club_detail', club_id=club.id) }}">
                      {{ club.name }}
                    </a>
                  </h5>

                  <span class="badge bg-primary-subtle text-primary mb-2">
                    You are an officer
                  </span>

                  {% if club.short_description %}
                    <p class="card-text small text-muted mb-3">
                      {{ club.short_description }}
                    </p>
                  {% else %}
                    <p class="card-text small text-muted mb-3">
                      No short description yet. Edit your club to add one.
                    </p>
                  {% endif %}

                  <div class="mt-auto d-flex justify-content-between align-items-center">
                    <a href="{{ url_for('club_detail', club_id=club.id) }}"
                       class="btn btn-sm btn-outline-primary">
                      View
                    </a>
                    <a href="{{ url_for('club_edit', club_id=club.id) }}"
                       class="btn btn-sm btn-outline-secondary">
                      Edit
                    </a>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted">
          Youâ€™re not an officer for any clubs yet. Create one to get started!
        </p>
      {% endif %}
    </div>

  {# --- ALL CLUBS TAB CONTENT --- #}
  {% else %}
    <div class="tab-pane fade show active">
      <h2 class="h5 fw-bold mb-3">All Clubs</h2>

      {% if clubs %}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
          {% for club in clubs %}
            <div class="col" style="animation: fadeInUp 0.5s ease-out backwards; animation-delay: {{ loop.index0 * 0.1 }}s;">
              <div class="card h-100 shadow-sm">
                {% if club.logo_filename %}
                  <img
                    src="{{ url_for('static', filename='uploads/' ~ club.logo_filename) }}"
                    class="card-img-top club-logo-img"
                    alt="{{ club.name }} logo"
                    width="100%"
                    height="70"
                  >
                {% endif %}
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title mb-1">
                    <a href="{{ url_for('club_detail', club_id=club.id) }}">
                      {{ club.name }}
                    </a>
                  </h5>

                  {% if current_user.is_authenticated and club.owner_id == current_user.id %}
                    <span class="badge bg-primary-subtle text-primary mb-2">
                      Officer
                    </span>
                  {% endif %}

                  {% if club.short_description %}
                    <p class="card-text small text-muted mb-3">
                      {{ club.short_description }}
                    </p>
                  {% else %}
                    <p class="card-text small text-muted mb-3">
                      No short description yet.
                    </p>
                  {% endif %}

                  <div class="mt-auto d-flex justify-content-between align-items-center">
                    <a href="{{ url_for('club_detail', club_id=club.id) }}"
                       class="btn btn-sm btn-outline-primary">
                      View
                    </a>

                    {% if current_user.is_authenticated and club.owner_id == current_user.id %}
                      <a href="{{ url_for('club_edit', club_id=club.id) }}"
                         class="btn btn-sm btn-outline-secondary">
                        Edit
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted">
          No clubs found. Try adjusting your search.
        </p>
      {% endif %}
    </div>
  {% endif %}
</div>

{% endblock %}
